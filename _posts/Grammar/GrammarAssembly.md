---
title: 汇编 语法
date: 2022-03-08 20:34:13
tags:
- 语法
---

2. 专用寄存器
ARM处理器中的专用寄存器主要包括程序状态寄存器（CPSR）和备份的程序状态寄存器（SPSRs）
3. 控制寄存器
CTRL 和 ACTLR

## 2.1 32位数据操作指令

| 名字         | 功能                             |                                           |
| ---------- | ------------------------------ | ----------------------------------------- |
| ADC        | 带进位加法                          |                                           |
| ADD        | 加法                             |                                           |
| ADDW       | 宽加法（可以加12位立即数）                 |                                           |
| AND        | 按位与                            |                                           |
| ASR        | 算术右移                           |                                           |
| BIC        | 位清零（把一个数按位取反后，与另一个数逻辑与）        |                                           |
| BFC        | 位段清零                           |                                           |
| BFI        | 位段插入                           |                                           |
| CMN        | 负向比较                           | 把一个数和另一个数的二进制补码比较，并更新标志位                  |
| CMP        | 比较两个数并更新标志位                    |                                           |
| CLZ        | 计算前导零的数目                       |                                           |
| EOR        | 按位异或                           |                                           |
| LSL        | 逻辑左移                           |                                           |
| LSR        | 逻辑右移                           |                                           |
| MLA        | 乘加                             |                                           |
| MLS        | 乘减                             |                                           |
| MOVW       | 把16位立即数放到寄存器的底16位，高16位清0       |                                           |
| MOV        | 加载16位立即数到寄存器                   | 其实汇编器会产生MOVW                              |
| MOVT       | 把16位立即数放到寄存器的高16位，低16位不影响      |                                           |
| MVN        | 移动一个数的补码                       |                                           |
| MUL        | 乘法                             |                                           |
| ORR        | 按位或                            |                                           |
| ORN        | 把源操作数按位取反后，再执行按位或              |                                           |
| RBIT       | 位反转                            | 把一个32位整数先用2进制表达，再旋转180度                   |
| REV        | 对一个32位整数做按字节反转                 |                                           |
| REVH/REV16 | 对一个32位整数的高低半字都执行字节反转           |                                           |
| REVSH      | 对一个32位整数的低半字执行字节反转，再带符号扩展成32位数 |                                           |
| ROR        | 圆圈右移                           |                                           |
| RRX        | 带进位的逻辑右移一格                     | 最高位用C填充，且不影响C的值                           |
| SFBX       | 从一个32位整数中提取任意的位段，并且带符号扩展成32位整数 |                                           |
| SDIV       | 带符号除法                          |                                           |
| SMLAL      | 带符号长乘加                         | 两个带符号的32位整数相乘得到64位的带符号积，再把积加到另一个带符号64位整数中 |
| SMULL      | 带符号长乘法                         | 两个带符号的32位整数相乘得到64位的带符号积                   |
| SSAT       | 带符号的饱和运算                       |                                           |
| SBC        | 带借位的减法                         |                                           |
| SUB        | 减法                             |                                           |
| SUBW       | 宽减法，可以减12位立即数                  |                                           |
| SXTB       | 字节带符号扩展到32位数                   |                                           |
| TEQ        | 测试是否相等                         | 对两个数执行异或，更新标志但不存储结果                       |
| TST        | 测试                             | 对两个数执行按位与，更新标志但不存储结果                      |
| UBFX       | 无符号位段提取                        |                                           |
| UDIV       | 无符号除法                          |                                           |
| UMLAL      | 无符号长乘加                         | 两个无符号的32位整数相乘得到64位的无符号积，再把积加到另一个无符号64位整数中 |
| UMULL      | 无符号长乘法                         | 两个无符号的32位整数相乘得到64位的无符号积                   |
| USAT       | 无符号饱和操作                        | 源操作数是带符号的                                 |
| UXTB       | 字节被无符号扩展到32位                   | 高24位清0                                    |
| UXTH       | 半字被无符号扩展到32位                   | 高16位清0                                    |


## 2.2 32位存储器数据传送指令
| 名字   | 功能                                                         |  
|--------|--------------------------------------------------------------|  
| LDR    | 加载字到寄存器                                              |  
| LDRB   | 加载字节到寄存器                                            |  
| LDRH   | 加载半字到寄存器                                            |  
| LDRSH  | 加载半字到寄存器，再带符号扩展到32位                       |  
| LDM    | 从一片连续的地址空间中加载多个字到若干寄存器             |  
| LDRD   | 从连续的地址空间加载双字（64位整数）到2个寄存器          |  
| STR    | 存储寄存器中的字                                            |  
| STRB   | 存储寄存器中的低字节                                        |  
| STRH   | 存储寄存器中的低半字                                        |  
| STM    | 存储若干寄存器中的字到一片连续的地址空间中              |  
| STRD   | 存储2个寄存器组成的双字到连续的地址空间中                 |  
| PUSH   | 把若干寄存器的值压入堆栈中                                 |  
| POP    | 从堆栈中弹出若干的寄存器的值                               |

## 2.3 32位转移指令

| 名字 | 功能                                                   |  
|------|--------------------------------------------------------|  
| B    | 无条件转移                                            |  
| BL   | 转移并连接（呼叫子程序）                             |  
| TBB  | 以字节为单位的查表转移。从一个字节数组中选一个8位前向跳转地址并转移 |  
| TBH  | 以半字为单位的查表转移。从一个半字数组中选一个16位前向跳转的地址并转移 |


## 2.4 其它32位指令
| 名字    | 功能                                                                                                                                              |  
|---------|-----------------------------------|  
| LDREX   | 加载字到寄存器，并且在内核中标明一段地址进入了互斥访问状态                                                                                       |  
| LDREXH  | 加载半字到寄存器，并且在内核中标明一段地址进入了互斥访问状态                                                                                     |  
| LDREXB  | 加载字节到寄存器，并且在内核中标明一段地址进入了互斥访问状态                                                                                   |  
| STREX   | 检查将要写入的地址是否已进入了互斥访问状态，如果是则存储寄存器的字                                                                             |  
| STREXH  | 检查将要写入的地址是否已进入了互斥访问状态，如果是则存储寄存器的半字                                                                          |  
| STREXB  | 检查将要写入的地址是否已进入了互斥访问状态，如果是则存储寄存器的字节                                                                          |  
| CLREX   | 在本地的处理上清除互斥访问状态的标记（先前由 LDREX/LDREXH/LDREXB做的标记）                                                                     |  
| MRS     | 加载特殊功能寄存器的值到通用寄存器                                                                                                             |  
| MSR     | 存储通用寄存器的值到特殊功能寄存器                                                                                                             |  
| NOP     | 无操作                                                                                                                                           |  
| SEV     | 发送事件                                                                                                                                         |  
| WFE     | 休眠并且在发生事件时被唤醒                                                                                                                       |  
| WFI     | 休眠并且在发生中断时被唤醒                                                                                                                       |  
| ISB     | 指令同步隔离（与流水线和 MPU等有关——译注）                                                                                                      |  
| DSB     | 数据同步隔离（与流水线、MPU 和cache等有关——译注）                                                                                             |  
| DMB     | 数据存储隔离（与流水线、MPU 和cache等有关——译注），保证：仅当所有在它前面的存储器访问操作都执行完毕后，才提交在它后面的存储器访问操作。       |  
| DSB     | 数据同步隔离，比 DMB 严格：仅当所有在它前面的存储器访问操作都执行完毕后，才执行在它后面的指令。                                             |  
| ISB     | 指令同步隔离，最严格：它会清洗流水线，以保证所有它前面的指令都执行完毕之后，才执行它后面的指令。                                              |

# 操作实例
bic和orr指令：bic为清除，orr为做或运算
```c
mrs	r0, cpsr //传送CPSR的内容到R0
and	r1, r0, #0x1f		@ mask mode bits
teq	r1, #0x1a		// test for HYP mode
bicne	r0, r0, #0x1f		@ clear all mode bits
orrne	r0, r0, #0x13		@ set SVC mode
orr	r0, r0, #0xc0		@ disable FIQ and IRQ
msr	cpsr,r0
```

MCR: 将 ARM 寄存器的数据写入到 CP15 协处理器寄存器中。

MRC 就是读 CP15 寄存器， 

# 参考汇编
```c
// 格式：LDR{条件} 目的寄存器，<存储器地址>
LDR  R0,[R1]           // 将存储器地址为R1的字数据读入寄存器R0
LDR  R0,[R1,R2]        // 将存储器地址为R1+R2的字数据读入寄存器R0
LDR  R0,[R1,#8]        // 将存储器地址为R1+8的字数据读入寄存器R0
LDR  R0,[R1,R2]!       // 将存储器地址为R1+R2的字数据读入寄存器R0，并将新地址R1＋R2写入R1
LDR  R0,[R1,#8]!       // 将存储器地址为R1+8的字数据读入寄存器R0，并将新地址R1＋8写入R1
LDR  R0,[R1],R2        // 将存储器地址为R1的字数据读入寄存器R0，并将新地址R1＋R2写入R1
LDR  R0,[R1,R2,LSL#2]! // 将存储器地址为R1＋R2×4的字数据读入寄存器R0，并将新地址R1＋R2×4写入R1
LDR  R0,[R1],R2,LSL#2  // 将存储器地址为R1的字数据读入寄存器R0，并将新地址R1＋R2×4写入R1
```

b指令：简单的程序跳转，跳转到到目标标号处执行。
bl指令：带链接程序跳转，也就是要带返回地址。在发生跳转前，将当前PC-4保存到R14中。
也就是返回地址存在R14中，所以可以在子程序返回时只要MOV PC, LR即可。


b .    ;死循环。"."--表示当前地址。
b reset    ;跳入reset处理程序
bl label    ;跳入label函数，同时将当前PC-4保存到R14中



# 参考文献：
[ARM全汇编指令（详细）整理附实例快速掌握](https://blog.csdn.net/Luckiers/article/details/128221506)
[ARM Architecture Reference Manual ARMv7-A and ARMv7-R edition](https://developer.arm.com/documentation/ddi0406/cd/?lang=en)
[Getting Started with Arm Assembly Language](https://developer.arm.com/documentation/107829/0200?lang=en)
